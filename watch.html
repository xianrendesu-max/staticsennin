<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>再生</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{background:#1e1e2f;color:#fff;font-family:sans-serif;margin:0;padding:1em}
.container{max-width:900px;margin:auto}
iframe{width:100%;height:450px;border-radius:8px;background:black}
.comment{margin:1em 0}
.bubble{background:#2d2f44;padding:.8em 1em;border-radius:16px}
.author{font-weight:bold}
.back{display:inline-block;margin-top:1em;background:#4caf50;color:#fff;padding:.5em 1em;border-radius:4px;text-decoration:none}
</style>
</head>
<body>

<div class="container">
<iframe id="player" allowfullscreen></iframe>
<h2 id="title">読み込み中...</h2>
<div id="meta"></div>
<a class="back" href="index.html">← 戻る</a>
<h3>コメント</h3>
<div id="comments">読み込み中...</div>
</div>

<script>
const VIDEO_APIS_EXTRA = [
    "https://invidious.exma.de/",
    "https://invidious.f5.si/",
    "https://siawaseok-wakame-server2.glitch.me/",
    "https://lekker.gay/",
    "https://id.420129.xyz/",
    "https://invid-api.poketube.fun/",
    "https://eu-proxy.poketube.fun/",
    "https://cal1.iv.ggtyler.dev/",
    "https://pol1.iv.ggtyler.dev/",
];

const COMMENTS_APIS_EXTRA = [
    "https://siawaseok-wakame-server2.glitch.me/",
    "https://invidious.0011.lt/",
    "https://invidious.nietzospannend.nl/",
];

const id=new URLSearchParams(location.search).get("id");
player.src=`https://www.youtube-nocookie.com/embed/${id}?autoplay=1`;

async function load(){
  for(const base of VIDEO_APIS_EXTRA){
    try{
      const r=await fetch(`${base}api/v1/videos/${id}`);
      if(!r.ok)continue;
      const v=await r.json();
      title.textContent=v.title;
      meta.innerHTML=`<a href="channel.html?id=${v.authorId}" style="color:#4fc3f7">${v.author}</a>`;
      break;
    }catch{}
  }

  for(const base of COMMENTS_APIS_EXTRA){
    try{
      const r=await fetch(`${base}api/v1/comments/${id}`);
      if(!r.ok)continue;
      const d=await r.json();
      comments.innerHTML="";
      d.comments.forEach(c=>{
        comments.innerHTML+=`
          <div class="comment">
            <div class="bubble">
              <div class="author">${c.author}</div>
              <div>${c.content}</div>
            </div>
          </div>`;
      });
      break;
    }catch{}
  }
}
load();
</script>
</body>
</html>
